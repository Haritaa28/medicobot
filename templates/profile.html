{% extends "layout.html" %}

{% block title %}Admin Dashboard - MedicoBot{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1><i class="fas fa-cogs"></i> Admin Dashboard</h1>
        <p>System Overview and Management</p>
    </div>

    <!-- Stats Overview -->
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-icon users">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_users }}</h3>
                <p>Total Users</p>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>12% this month</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon predictions">
                <i class="fas fa-stethoscope"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_predictions }}</h3>
                <p>Total Predictions</p>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>8% this week</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon chats">
                <i class="fas fa-comments"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_chats }}</h3>
                <p>Chat Sessions</p>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>15% today</span>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon accuracy">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
                <h3>87%</h3>
                <p>System Accuracy</p>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>2% improvement</span>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-content">
        <!-- Left Column -->
        <div class="admin-left">
            <!-- System Health -->
            <div class="admin-card">
                <h3><i class="fas fa-heartbeat"></i> System Health</h3>
                <div class="health-metrics">
                    <div class="metric">
                        <div class="metric-label">
                            <span>API Status</span>
                            <span class="metric-value" id="apiStatus">Checking...</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="apiBar"></div>
                        </div>
                    </div>

                    <div class="metric">
                        <div class="metric-label">
                            <span>Database</span>
                            <span class="metric-value" id="dbStatus">Checking...</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="dbBar"></div>
                        </div>
                    </div>

                    <div class="metric">
                        <div class="metric-label">
                            <span>Storage</span>
                            <span class="metric-value" id="storageStatus">Checking...</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="storageBar"></div>
                        </div>
                    </div>

                    <div class="metric">
                        <div class="metric-label">
                            <span>Response Time</span>
                            <span class="metric-value" id="responseStatus">Checking...</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="responseBar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="admin-card">
                <div class="card-header">
                    <h3><i class="fas fa-history"></i> Recent System Activity</h3>
                    <button class="btn btn-sm" onclick="refreshActivity()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                <div class="activity-log" id="activityLog">
                    <!-- Activity items will be loaded here -->
                    <div class="loading">Loading activities...</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="admin-card">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <div class="quick-actions-grid">
                    <button class="action-btn" onclick="clearCache()">
                        <i class="fas fa-trash"></i>
                        <span>Clear Cache</span>
                    </button>
                    <button class="action-btn" onclick="backupDatabase()">
                        <i class="fas fa-database"></i>
                        <span>Backup DB</span>
                    </button>
                    <button class="action-btn" onclick="updateModels()">
                        <i class="fas fa-brain"></i>
                        <span>Update Models</span>
                    </button>
                    <button class="action-btn" onclick="checkUpdates()">
                        <i class="fas fa-download"></i>
                        <span>Check Updates</span>
                    </button>
                    <button class="action-btn" onclick="viewLogs()">
                        <i class="fas fa-file-alt"></i>
                        <span>View Logs</span>
                    </button>
                    <button class="action-btn" onclick="restartService()">
                        <i class="fas fa-redo"></i>
                        <span>Restart Service</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="admin-right">
            <!-- User Management -->
            <div class="admin-card">
                <div class="card-header">
                    <h3><i class="fas fa-user-cog"></i> User Management</h3>
                    <a href="{{ url_for('admin_viewer') }}" class="btn btn-sm">
                        <i class="fas fa-external-link-alt"></i> View All
                    </a>
                </div>
                <div class="user-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Joined</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- System Configuration -->
            <div class="admin-card">
                <h3><i class="fas fa-sliders-h"></i> System Configuration</h3>
                <form class="config-form" id="configForm">
                    <div class="form-group">
                        <label for="appMode">Application Mode</label>
                        <select id="appMode" class="form-control">
                            <option value="production">Production</option>
                            <option value="development">Development</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="enable_registration" checked>
                                <span>Enable Registration</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="enable_guest" checked>
                                <span>Enable Guest Access</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="enable_ai" checked>
                                <span>Enable AI Features</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sessionTimeout">Session Timeout (minutes)</label>
                        <input type="number" id="sessionTimeout" value="30" min="5" max="1440" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="logLevel">Log Level</label>
                        <select id="logLevel" class="form-control">
                            <option value="debug">Debug</option>
                            <option value="info" selected>Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                </form>
            </div>

            <!-- Performance Metrics -->
            <div class="admin-card">
                <h3><i class="fas fa-tachometer-alt"></i> Performance Metrics</h3>
                <div class="metrics-chart">
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="metrics-summary">
                    <div class="summary-item">
                        <span>Avg. Response Time</span>
                        <strong id="avgResponse">0.45s</strong>
                    </div>
                    <div class="summary-item">
                        <span>Requests/Minute</span>
                        <strong id="requestsPerMin">42</strong>
                    </div>
                    <div class="summary-item">
                        <span>Error Rate</span>
                        <strong id="errorRate">1.2%</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Log Viewer Modal -->
<div id="logModal" class="modal">
    <div class="modal-content wide">
        <div class="modal-header">
            <h3>System Logs</h3>
            <button class="modal-close" onclick="closeLogModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="log-controls">
                <select id="logLevelFilter" class="form-control">
                    <option value="all">All Levels</option>
                    <option value="debug">Debug</option>
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="error">Error</option>
                </select>
                <button class="btn btn-sm" onclick="downloadLogs()">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn btn-sm" onclick="clearLogs()">
                    <i class="fas fa-trash"></i> Clear
                </button>
            </div>
            <div class="log-viewer" id="logViewer">
                <pre>Loading logs...</pre>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let performanceChart;

    document.addEventListener('DOMContentLoaded', function() {
        loadSystemHealth();
        loadRecentUsers();
        loadActivityLog();
        initializeChart();
        loadSystemConfig();

        // Auto refresh every 30 seconds
        setInterval(loadSystemHealth, 30000);
        setInterval(loadActivityLog, 30000);
    });

    async function loadSystemHealth() {
        try {
            const response = await fetch('/api/status');
            const data = await response.json();

            // Update API status
            const apiStatus = document.getElementById('apiStatus');
            const apiBar = document.getElementById('apiBar');
            if (data.gemini_api) {
                apiStatus.textContent = 'Online';
                apiStatus.style.color = '#4dff4d';
                apiBar.style.width = '100%';
                apiBar.style.backgroundColor = '#4dff4d';
            } else {
                apiStatus.textContent = 'Offline';
                apiStatus.style.color = '#ff4d4d';
                apiBar.style.width = '30%';
                apiBar.style.backgroundColor = '#ff4d4d';
            }

            // Update other metrics (simulated)
            updateMetric('dbStatus', 'dbBar', 95, '#4dff4d');
            updateMetric('storageStatus', 'storageBar', 65, '#ffd24d');
            updateMetric('responseStatus', 'responseBar', 88, '#4dff4d');

        } catch (error) {
            console.error('Error loading system health:', error);
        }
    }

    function updateMetric(statusId, barId, percentage, color) {
        const status = document.getElementById(statusId);
        const bar = document.getElementById(barId);

        status.textContent = `${percentage}%`;
        status.style.color = color;
        bar.style.width = `${percentage}%`;
        bar.style.backgroundColor = color;
    }

    async function loadRecentUsers() {
        try {
            const response = await fetch('/api/admin/users?limit=5');
            const users = await response.json();

            const tableBody = document.getElementById('usersTable');
            tableBody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td><span class="status-badge active">Active</span></td>
                    <td>
                        <button class="action-icon" onclick="viewUser(${user.id})" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-icon" onclick="editUser(${user.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-icon delete" onclick="deleteUser(${user.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

        } catch (error) {
            console.error('Error loading users:', error);
            document.getElementById('usersTable').innerHTML = `
                <tr><td colspan="6" class="error">Error loading users</td></tr>
            `;
        }
    }

    async function loadActivityLog() {
        try {
            const response = await fetch('/api/admin/activity');
            const activities = await response.json();

            const logContainer = document.getElementById('activityLog');
            logContainer.innerHTML = '';

            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';

                let icon = 'fa-info-circle';
                let color = '#4d79ff';

                if (activity.type === 'error') {
                    icon = 'fa-exclamation-circle';
                    color = '#ff4d4d';
                } else if (activity.type === 'warning') {
                    icon = 'fa-exclamation-triangle';
                    color = '#ffd24d';
                } else if (activity.type === 'success') {
                    icon = 'fa-check-circle';
                    color = '#4dff4d';
                }

                activityItem.innerHTML = `
                    <div class="activity-icon" style="background: ${color}20; color: ${color};">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="activity-content">
                        <p>${activity.message}</p>
                        <div class="activity-meta">
                            <span><i class="fas fa-clock"></i> ${activity.time}</span>
                            <span><i class="fas fa-user"></i> ${activity.user || 'System'}</span>
                        </div>
                    </div>
                `;

                logContainer.appendChild(activityItem);
            });

        } catch (error) {
            console.error('Error loading activity log:', error);
        }
    }

    function initializeChart() {
        const ctx = document.getElementById('performanceChart').getContext('2d');

        performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['6am', '9am', '12pm', '3pm', '6pm', '9pm', '12am'],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [450, 420, 380, 410, 460, 490, 420],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    fill: true,
                    tension: 0.4
                }, {
                    label: 'Requests/Min',
                    data: [25, 45, 60, 55, 40, 30, 20],
                    borderColor: '#43e97b',
                    backgroundColor: 'rgba(67, 233, 123, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });
    }

    async function loadSystemConfig() {
        try {
            const response = await fetch('/api/admin/config');
            const config = await response.json();

            // Update form values
            document.getElementById('appMode').value = config.app_mode || 'production';
            document.getElementById('sessionTimeout').value = config.session_timeout || 30;
            document.getElementById('logLevel').value = config.log_level || 'info';

            // Update checkboxes
            const checkboxes = {
                'enable_registration': config.enable_registration,
                'enable_guest': config.enable_guest,
                'enable_ai': config.enable_ai
            };

            for (const [name, value] of Object.entries(checkboxes)) {
                const checkbox = document.querySelector(`input[name="${name}"]`);
                if (checkbox) {
                    checkbox.checked = value;
                }
            }

        } catch (error) {
            console.error('Error loading config:', error);
        }
    }

    document.getElementById('configForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData);

        // Add other form values
        data.app_mode = document.getElementById('appMode').value;
        data.session_timeout = document.getElementById('sessionTimeout').value;
        data.log_level = document.getElementById('logLevel').value;

        try {
            const response = await fetch('/api/admin/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                showNotification('Configuration saved successfully!', 'success');
            } else {
                showNotification('Error saving configuration', 'error');
            }
        } catch (error) {
            console.error('Error saving config:', error);
            showNotification('Network error. Please try again.', 'error');
        }
    });

    // Admin Actions
    function clearCache() {
        if (confirm('Clear all system cache?')) {
            fetch('/api/admin/clear-cache', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification('Cache cleared successfully!', 'success');
                    loadSystemHealth();
                })
                .catch(error => {
                    console.error('Error clearing cache:', error);
                    showNotification('Error clearing cache', 'error');
                });
        }
    }

    function backupDatabase() {
        if (confirm('Create database backup?')) {
            fetch('/api/admin/backup', { method: 'POST' })
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `medicobot-backup-${new Date().toISOString().split('T')[0]}.sql`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showNotification('Backup downloaded successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error creating backup:', error);
                    showNotification('Error creating backup', 'error');
                });
        }
    }

    function updateModels() {
        if (confirm('Update AI models? This may take a few minutes.')) {
            showNotification('Updating AI models...', 'info');
            fetch('/api/admin/update-models', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification('AI models updated successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error updating models:', error);
                    showNotification('Error updating models', 'error');
                });
        }
    }

    function checkUpdates() {
        showNotification('Checking for updates...', 'info');
        fetch('/api/admin/check-updates')
            .then(response => response.json())
            .then(data => {
                if (data.update_available) {
                    if (confirm(`Update available: ${data.latest_version}. Install now?`)) {
                        installUpdate();
                    }
                } else {
                    showNotification('System is up to date!', 'success');
                }
            })
            .catch(error => {
                console.error('Error checking updates:', error);
                showNotification('Error checking updates', 'error');
            });
    }

    function installUpdate() {
        showNotification('Installing update...', 'info');
        fetch('/api/admin/install-update', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                showNotification('Update installed successfully! Restarting...', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            })
            .catch(error => {
                console.error('Error installing update:', error);
                showNotification('Error installing update', 'error');
            });
    }

    function viewLogs() {
        document.getElementById('logModal').style.display = 'flex';
        loadLogs();
    }

    function closeLogModal() {
        document.getElementById('logModal').style.display = 'none';
    }

    async function loadLogs() {
        try {
            const response = await fetch('/api/admin/logs');
            const logs = await response.text();
            document.getElementById('logViewer').innerHTML = `<pre>${logs}</pre>`;
        } catch (error) {
            console.error('Error loading logs:', error);
            document.getElementById('logViewer').innerHTML = `<pre>Error loading logs</pre>`;
        }
    }

    function downloadLogs() {
        const logs = document.getElementById('logViewer').textContent;
        const blob = new Blob([logs], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `medicobot-logs-${new Date().toISOString().split('T')[0]}.log`;
        a.click();
        window.URL.revokeObjectURL(url);
    }

    function clearLogs() {
        if (confirm('Clear all system logs?')) {
            fetch('/api/admin/clear-logs', { method: 'POST' })
                .then(() => {
                    loadLogs();
                    showNotification('Logs cleared successfully!', 'success');
                })
                .catch(error => {
                    console.error('Error clearing logs:', error);
                    showNotification('Error clearing logs', 'error');
                });
        }
    }

    function restartService() {
        if (confirm('Restart the application service? This will interrupt active sessions.')) {
            fetch('/api/admin/restart', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification('Service restart initiated. Please wait...', 'info');
                    setTimeout(() => {
                        window.location.reload();
                    }, 3000);
                })
                .catch(error => {
                    console.error('Error restarting service:', error);
                    showNotification('Error restarting service', 'error');
                });
        }
    }

    function refreshActivity() {
        loadActivityLog();
        showNotification('Activity log refreshed!', 'success');
    }

    function viewUser(userId) {
        window.location.href = `/admin/user/${userId}`;
    }

    function editUser(userId) {
        window.location.href = `/admin/user/${userId}/edit`;
    }

    function deleteUser(userId) {
        if (confirm('Delete this user? This action cannot be undone.')) {
            fetch(`/api/admin/user/${userId}`, { method: 'DELETE' })
                .then(response => response.json())
                .then(data => {
                    showNotification('User deleted successfully!', 'success');
                    loadRecentUsers();
                })
                .catch(error => {
                    console.error('Error deleting user:', error);
                    showNotification('Error deleting user', 'error');
                });
        }
    }

    function showNotification(message, type) {
        if (window.MedicoBot && window.MedicoBot.showNotification) {
            window.MedicoBot.showNotification(message, type);
        } else {
            alert(message);
        }
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('logModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>

<style>
    .admin-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    .admin-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .admin-header h1 {
        font-size: 2.5rem;
        color: #2c3e50;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }

    .admin-header p {
        color: #666;
        font-size: 1.1rem;
    }

    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .stat-icon {
        width: 70px;
        height: 70px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
    }

    .stat-icon.users { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-icon.predictions { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .stat-icon.chats { background: linear-gradient(135deg, #ff4d4d 0%, #ff944d 100%); }
    .stat-icon.accuracy { background: linear-gradient(135deg, #4d79ff 0%, #00ccff 100%); }

    .stat-content h3 {
        font-size: 2rem;
        color: #2c3e50;
        margin: 0 0 5px;
    }

    .stat-content p {
        color: #666;
        margin: 0 0 8px;
        font-size: 0.95rem;
    }

    .stat-trend {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.85rem;
        color: #43e97b;
    }

    .stat-trend .fa-arrow-up {
        font-size: 0.8rem;
    }

    .admin-content {
        display: grid;
        grid-template-columns: 1fr 1.5fr;
        gap: 30px;
    }

    @media (max-width: 1200px) {
        .admin-content {
            grid-template-columns: 1fr;
        }
    }

    .admin-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .admin-card h3 {
        margin-bottom: 20px;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .health-metrics {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .metric {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .metric-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .metric-value {
        font-weight: 600;
        font-size: 0.95rem;
    }

    .metric-bar {
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
    }

    .metric-fill {
        height: 100%;
        width: 0%;
        border-radius: 4px;
        transition: width 1s ease;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .activity-log {
        max-height: 300px;
        overflow-y: auto;
    }

    .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .activity-content {
        flex: 1;
    }

    .activity-content p {
        margin: 0 0 8px;
        color: #333;
        font-size: 0.95rem;
    }

    .activity-meta {
        display: flex;
        gap: 15px;
        font-size: 0.85rem;
        color: #888;
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #888;
        font-style: italic;
    }

    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
    }

    @media (max-width: 768px) {
        .quick-actions-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .action-btn {
        padding: 15px;
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
    }

    .action-btn:hover {
        background: #e9ecef;
        border-color: #667eea;
        transform: translateY(-2px);
    }

    .action-btn i {
        font-size: 1.5rem;
        color: #667eea;
    }

    .action-btn span {
        font-size: 0.9rem;
        color: #555;
    }

    .user-table {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th {
        background: #f8f9fa;
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        color: #555;
        font-size: 0.9rem;
        border-bottom: 2px solid #e0e0e0;
    }

    td {
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
        color: #555;
    }

    .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .status-badge.active {
        background: #e8f5e9;
        color: #388e3c;
    }

    .action-icon {
        width: 32px;
        height: 32px;
        border: none;
        border-radius: 6px;
        background: #f0f4ff;
        color: #667eea;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 5px;
        transition: all 0.3s;
    }

    .action-icon:hover {
        background: #667eea;
        color: white;
    }

    .action-icon.delete {
        background: #ffeaea;
        color: #e74c3c;
    }

    .action-icon.delete:hover {
        background: #e74c3c;
        color: white;
    }

    .config-form .form-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 20px;
    }

    @media (max-width: 768px) {
        .config-form .form-row {
            grid-template-columns: 1fr;
        }
    }

    .config-form .form-group {
        margin-bottom: 20px;
    }

    .config-form label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        color: #555;
    }

    .config-form input[type="checkbox"] {
        width: auto;
    }

    .metrics-chart {
        height: 200px;
        margin-bottom: 20px;
    }

    .metrics-summary {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        padding-top: 15px;
        border-top: 1px solid #f0f0f0;
    }

    .summary-item {
        text-align: center;
    }

    .summary-item span {
        display: block;
        font-size: 0.85rem;
        color: #888;
        margin-bottom: 5px;
    }

    .summary-item strong {
        font-size: 1.2rem;
        color: #2c3e50;
    }

    .modal.wide .modal-content {
        max-width: 800px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
    }

    .log-controls {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        align-items: center;
    }

    .log-controls .form-control {
        flex: 1;
    }

    .log-viewer {
        flex: 1;
        background: #2c3e50;
        border-radius: 8px;
        overflow: auto;
        padding: 20px;
    }

    .log-viewer pre {
        color: #ecf0f1;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    .error {
        color: #e74c3c;
        text-align: center;
        padding: 20px;
    }
</style>
{% endblock %}